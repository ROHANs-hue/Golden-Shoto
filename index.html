
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Golden Shoto Karate Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', 'Noto Sans JP', sans-serif;
        background-color: #f8fafc;
      }
      .belt-shadow {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #f1f1f1; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.2.3",
    "react-dom/client": "https://esm.sh/react-dom@19.2.3/client",
    "@google/genai": "https://esm.sh/@google/genai@1.37.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI, Type } from "@google/genai";

      // --- 1. TYPES ---
      const BeltColor = {
        WHITE: 'White', YELLOW: 'Yellow', YELLOW_2: 'Yellow 2', BLUE: 'Blue',
        GREEN: 'Green', PURPLE: 'Purple', BROWN: 'Brown', BROWN_1: 'Brown 1',
        BROWN_2: 'Brown 2', BLACK: 'Black'
      };

      const beltStyles = {
        [BeltColor.WHITE]: 'bg-white text-gray-800 border-gray-200',
        [BeltColor.YELLOW]: 'bg-yellow-400 text-yellow-900 border-yellow-500',
        [BeltColor.YELLOW_2]: 'bg-yellow-500 text-yellow-900 border-yellow-600 border-b-4 border-yellow-700',
        [BeltColor.BLUE]: 'bg-blue-600 text-white border-blue-700',
        [BeltColor.GREEN]: 'bg-green-600 text-white border-green-700',
        [BeltColor.PURPLE]: 'bg-purple-600 text-white border-purple-700',
        [BeltColor.BROWN]: 'bg-amber-900 text-white border-amber-950',
        [BeltColor.BROWN_1]: 'bg-amber-900 text-white border-r-4 border-yellow-400',
        [BeltColor.BROWN_2]: 'bg-amber-900 text-white border-r-8 border-yellow-400',
        [BeltColor.BLACK]: 'bg-black text-white border-gray-800',
      };

      // --- 2. SERVICE ---
      const generateQuiz = async (belt) => {
        const ai = new GoogleGenAI({ apiKey: process.env.API_KEY || "" });
        const prompt = `Generate 5 high-quality multiple choice questions for a Karate student at the ${belt} belt level. 
        For every text field, provide both English and a natural Bengali translation. 
        Focus on terminology, stances, and dojo etiquette. Return JSON.`;

        const response = await ai.models.generateContent({
          model: "gemini-3-flash-preview",
          contents: prompt,
          config: {
            responseMimeType: "application/json",
            responseSchema: {
              type: Type.ARRAY,
              items: {
                type: Type.OBJECT,
                properties: {
                  question: { type: Type.STRING },
                  questionBengali: { type: Type.STRING },
                  options: { type: Type.ARRAY, items: { type: Type.STRING } },
                  optionsBengali: { type: Type.ARRAY, items: { type: Type.STRING } },
                  correctAnswer: { type: Type.INTEGER },
                  explanation: { type: Type.STRING },
                  explanationBengali: { type: Type.STRING }
                },
                required: ["question", "questionBengali", "options", "optionsBengali", "correctAnswer", "explanation", "explanationBengali"]
              }
            }
          }
        });
        return JSON.parse(response.text.trim());
      };

      // --- 3. COMPONENTS ---

      const AdminPortal = ({ onBack }) => {
        const [pin, setPin] = useState('');
        const [isAuth, setIsAuth] = useState(false);
        const [results, setResults] = useState([]);

        useEffect(() => {
          if (isAuth) setResults(JSON.parse(localStorage.getItem('dojo_cloud_data') || '[]'));
        }, [isAuth]);

        const login = (e) => {
          e.preventDefault();
          if (pin === '2005') setIsAuth(true);
          else alert('Invalid PIN');
        };

        if (!isAuth) return (
          <div className="min-h-screen bg-slate-950 flex items-center justify-center p-4">
            <form onSubmit={login} className="bg-white p-8 rounded-3xl shadow-2xl max-w-sm w-full text-center">
              <div className="w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-6">
                 <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
              </div>
              <h2 className="text-xl font-bold mb-6">Sensei Verification</h2>
              <input type="password" maxLength={4} value={pin} onChange={e=>setPin(e.target.value)} className="w-full px-4 py-4 text-center text-3xl tracking-[0.5em] border-2 rounded-2xl mb-6 outline-none focus:border-red-500" placeholder="••••" />
              <button type="submit" className="w-full py-4 bg-red-600 text-white font-bold rounded-2xl">Verify</button>
              <button type="button" onClick={onBack} className="mt-4 text-xs text-slate-400">Cancel</button>
            </form>
          </div>
        );

        return (
          <div className="max-w-6xl mx-auto p-8 animate-in fade-in duration-500">
            <div className="flex justify-between items-center mb-8">
              <h1 className="text-3xl font-black">Master Cloud Portal</h1>
              <button onClick={onBack} className="px-6 py-2 bg-slate-200 rounded-xl font-bold">Close</button>
            </div>
            <div className="bg-white rounded-3xl shadow-xl overflow-hidden border">
              <table className="w-full text-left">
                <thead className="bg-slate-50 border-b">
                  <tr><th className="p-5 font-bold text-xs uppercase text-slate-400">Student</th><th className="p-5 font-bold text-xs uppercase text-slate-400">Belt</th><th className="p-5 font-bold text-xs uppercase text-slate-400">Score</th><th className="p-5 font-bold text-xs uppercase text-slate-400">Date</th></tr>
                </thead>
                <tbody>
                  {results.length === 0 ? <tr><td colSpan="4" className="p-10 text-center text-slate-400 italic">No records found.</td></tr> : results.map(r => (
                    <tr key={r.id} className="border-b last:border-0">
                      <td className="p-5 font-bold">{r.studentName}</td>
                      <td className="p-5 text-xs font-bold uppercase">{r.belt}</td>
                      <td className="p-5 font-mono">{r.score}/{r.total}</td>
                      <td className="p-5 text-xs text-slate-400">{new Date(r.timestamp).toLocaleDateString()}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        );
      };

      const Results = ({ questions, answers, onBack }) => {
        const score = questions.reduce((acc, q, idx) => (q.correctAnswer === answers[idx] ? acc + 1 : acc), 0);
        return (
          <div className="max-w-3xl mx-auto p-8 animate-in zoom-in duration-500">
            <div className="bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-slate-100">
              <div className="bg-slate-900 text-white p-12 text-center">
                <p className="text-xs uppercase tracking-widest text-yellow-500 font-black mb-4">Training Synchronized</p>
                <div className="text-7xl font-black mb-4">{score}/{questions.length}</div>
                <p className="text-slate-400 max-w-xs mx-auto text-sm">Your results have been securely uploaded to the Dojo Master records.</p>
              </div>
              <div className="p-8 space-y-6">
                {questions.map((q, idx) => (
                  <div key={idx} className={`p-6 rounded-2xl border-l-8 ${answers[idx] === q.correctAnswer ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}`}>
                    <p className="font-bold text-slate-800">{q.question}</p>
                    <p className="text-sm font-bold text-slate-500 italic mt-1">{q.questionBengali}</p>
                  </div>
                ))}
                <button onClick={onBack} className="w-full py-5 bg-yellow-600 text-white font-black rounded-2xl shadow-xl hover:bg-yellow-500 transition-all uppercase tracking-widest">Return to Dojo</button>
              </div>
            </div>
          </div>
        );
      };

      const QuizEngine = ({ questions, onFinish, onCancel }) => {
        const [curr, setCurr] = useState(0);
        const [ans, setAns] = useState([]);
        const [timer, setTimer] = useState(120);

        useEffect(() => {
          const t = setInterval(() => setTimer(v => v > 0 ? v - 1 : 0), 1000);
          return () => clearInterval(t);
        }, []);

        const q = questions[curr];
        const next = () => curr < questions.length - 1 ? setCurr(curr + 1) : onFinish(ans);

        return (
          <div className="max-w-4xl mx-auto p-8 pt-16">
            <div className="flex justify-between items-end mb-8">
               <h2 className="text-2xl font-black text-slate-800 uppercase tracking-tighter">Golden Inquiry</h2>
               <div className={`text-4xl font-mono font-black ${timer < 20 ? 'text-red-600 animate-pulse' : 'text-slate-800'}`}>{timer}s</div>
            </div>
            <div className="bg-white p-10 md:p-14 rounded-[3rem] shadow-2xl min-h-[550px] flex flex-col border border-slate-50">
               <div className="mb-12">
                 <h3 className="text-3xl font-black text-slate-900 leading-tight mb-4">{q.question}</h3>
                 <p className="text-2xl font-bold text-yellow-600 italic">{q.questionBengali}</p>
               </div>
               <div className="grid gap-4 mt-auto">
                 {q.options.map((o, idx) => (
                   <button key={idx} onClick={() => { const a = [...ans]; a[curr] = idx; setAns(a); }} 
                     className={`w-full p-6 text-left rounded-2xl border-2 transition-all flex items-center gap-6 ${ans[curr] === idx ? 'border-yellow-600 bg-yellow-50 scale-[1.02]' : 'border-slate-100 bg-slate-50'}`}>
                     <span className={`w-10 h-10 rounded-xl flex items-center justify-center font-black ${ans[curr] === idx ? 'bg-yellow-600 text-white' : 'bg-white text-slate-300'}`}>{idx+1}</span>
                     <div>
                       <p className="font-bold text-lg">{o}</p>
                       <p className="text-sm text-slate-400 font-medium">{q.optionsBengali[idx]}</p>
                     </div>
                   </button>
                 ))}
               </div>
               <button onClick={next} disabled={ans[curr] === undefined} className="mt-12 py-5 bg-slate-900 text-white font-black rounded-2xl uppercase tracking-[0.2em] disabled:opacity-50 transition-all hover:bg-black">Submit Strike</button>
            </div>
          </div>
        );
      };

      const Dashboard = ({ user, onLogout, onStartQuiz }) => {
        const [loading, setLoading] = useState(false);
        const handleStart = async () => {
          setLoading(true);
          try { const q = await generateQuiz(user.belt); onStartQuiz(q); }
          catch (e) { alert("Dojo connection lost."); setLoading(false); }
        };

        return (
          <div className="max-w-5xl mx-auto p-8 space-y-10 animate-in fade-in duration-700">
            <nav className="flex justify-between items-center border-b pb-6">
              <div className="flex items-center gap-3">
                <div className="bg-yellow-600 w-10 h-10 rounded-xl flex items-center justify-center text-white font-black italic shadow-lg">GS</div>
                <div className="font-black text-xl tracking-tighter uppercase">Golden Shoto <span className="text-slate-400 font-normal">Academy</span></div>
              </div>
              <button onClick={onLogout} className="text-xs font-black text-red-500 uppercase tracking-widest hover:text-red-700 transition-colors">Logout</button>
            </nav>
            <div className="bg-white p-10 rounded-3xl shadow-sm border border-slate-100 flex flex-col md:flex-row items-center gap-10">
              <div className={`w-24 h-24 rounded-2xl flex items-center justify-center text-4xl font-black shadow-2xl rotate-3 ${beltStyles[user.belt] || 'bg-slate-100'}`}>
                {user.belt.charAt(0)}
              </div>
              <div className="text-center md:text-left">
                <h2 className="text-4xl font-black text-slate-900 mb-2">Osu, Student {user.name}!</h2>
                <p className="text-slate-400 uppercase text-xs font-black tracking-[0.3em] flex items-center justify-center md:justify-start gap-2">
                   Current Rank: <span className="text-yellow-600">{user.belt}</span>
                </p>
              </div>
            </div>
            <div className="bg-slate-900 p-16 rounded-[3rem] text-white shadow-2xl relative overflow-hidden group border-b-8 border-yellow-600">
              <div className="absolute top-0 right-0 p-10 opacity-10 group-hover:scale-125 transition-transform duration-1000">
                 <svg width="200" height="200" fill="white" viewBox="0 0 24 24"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/></svg>
              </div>
              <div className="relative z-10">
                <h3 className="text-5xl font-black mb-6 leading-tight">Mastery starts <br/> with knowledge.</h3>
                <p className="text-slate-400 mb-12 max-w-md text-lg leading-relaxed">The mental kata is as important as the physical. Sharpen your mind with rank-specific terminology.</p>
                <button onClick={handleStart} disabled={loading} className="px-12 py-6 bg-yellow-600 hover:bg-yellow-500 rounded-2xl font-black uppercase text-sm tracking-widest transition-all shadow-xl active:scale-95 disabled:opacity-50">
                  {loading ? 'Preparing Dojo...' : 'Begin Examination'}
                </button>
              </div>
            </div>
          </div>
        );
      };

      const Login = ({ onLogin, onOpenAdmin }) => {
        const [name, setName] = useState('');
        const [pass, setPass] = useState('');
        const [belt, setBelt] = useState(BeltColor.WHITE);

        return (
          <div className="min-h-screen flex items-center justify-center p-4 bg-slate-900 bg-[url('https://images.unsplash.com/photo-1552072092-7f9b8d63efcb?q=80&w=2000')] bg-cover bg-center">
            <div className="absolute inset-0 bg-slate-950/80 backdrop-blur-xl"></div>
            <div className="relative w-full max-w-md bg-white rounded-[2.5rem] shadow-2xl overflow-hidden animate-in fade-in slide-in-from-bottom-12 duration-1000">
              <div className="bg-yellow-600 p-12 text-white text-center border-b-8 border-yellow-700">
                <h1 className="text-4xl font-black tracking-tighter uppercase mb-2">Golden Shoto</h1>
                <p className="text-[10px] font-black opacity-60 uppercase tracking-[0.4em]">Karate Academy Portal</p>
              </div>
              <form className="p-10 space-y-5" onSubmit={(e)=>{ e.preventDefault(); if(name && pass) onLogin({name, belt}); }}>
                <div className="space-y-1">
                  <label className="text-[10px] font-black text-slate-300 uppercase tracking-widest ml-1">Student Identity</label>
                  <input required placeholder="Full Name" value={name} onChange={e=>setName(e.target.value)} className="w-full px-6 py-4 border-2 border-slate-50 rounded-2xl focus:ring-4 focus:ring-yellow-500/20 focus:border-yellow-600 outline-none transition-all font-medium" />
                </div>
                <div className="space-y-1">
                  <label className="text-[10px] font-black text-slate-300 uppercase tracking-widest ml-1">Dojo Password</label>
                  <input required type="password" placeholder="••••••••" value={pass} onChange={e=>setPass(e.target.value)} className="w-full px-6 py-4 border-2 border-slate-50 rounded-2xl focus:ring-4 focus:ring-yellow-500/20 focus:border-yellow-600 outline-none transition-all" />
                </div>
                <div className="pt-2">
                   <label className="text-[10px] font-black text-slate-300 uppercase tracking-widest ml-1 mb-2 block">Current Rank</label>
                   <div className="grid grid-cols-5 gap-1.5">
                    {Object.values(BeltColor).map(b => (
                      <button key={b} type="button" onClick={()=>setBelt(b)} title={b} className={`py-3 text-[9px] font-black rounded-xl border-2 uppercase truncate px-1 transition-all ${belt === b ? 'bg-yellow-600 text-white border-yellow-700 shadow-md scale-105' : 'bg-slate-50 text-slate-300 border-transparent hover:border-slate-200'}`}>
                        {b.split(' ')[0]}
                      </button>
                    ))}
                  </div>
                </div>
                <button type="submit" className="w-full py-5 bg-slate-900 hover:bg-black text-white font-black rounded-2xl uppercase tracking-widest transition-all active:scale-95 shadow-2xl mt-6">Enter Academy</button>
                <button type="button" onClick={onOpenAdmin} className="w-full text-center text-[10px] font-black text-slate-400 uppercase tracking-widest mt-8 hover:text-red-600 transition-colors">Sensei / Staff Access</button>
              </form>
            </div>
          </div>
        );
      };

      // --- 4. MAIN APP ---
      const App = () => {
        const [user, setUser] = useState(null);
        const [screen, setScreen] = useState('auth');
        const [qs, setQs] = useState([]);
        const [ans, setAns] = useState([]);

        useEffect(() => {
          const saved = localStorage.getItem('dojo_user');
          if (saved) { setUser(JSON.parse(saved)); setScreen('dash'); }
        }, []);

        const login = (u) => { setUser(u); localStorage.setItem('dojo_user', JSON.stringify(u)); setScreen('dash'); };
        const logout = () => { setUser(null); localStorage.removeItem('dojo_user'); setScreen('auth'); };
        const start = (q) => { setQs(q); setAns([]); setScreen('quiz'); };
        const finish = (a) => {
          setAns(a);
          const res = { id: Math.random().toString(36).substr(2, 9), studentName: user.name, belt: user.belt, score: qs.reduce((acc,q,i)=>q.correctAnswer===a[i]?acc+1:acc,0), total: qs.length, timestamp: Date.now() };
          const cloud = JSON.parse(localStorage.getItem('dojo_cloud_data') || '[]');
          localStorage.setItem('dojo_cloud_data', JSON.stringify([res, ...cloud]));
          setScreen('results');
        };

        return (
          <div className="min-h-screen bg-slate-50 text-slate-900 selection:bg-yellow-200">
            {screen === 'auth' && <Login onLogin={login} onOpenAdmin={() => setScreen('admin')} />}
            {screen === 'admin' && <AdminPortal onBack={() => setScreen('auth')} />}
            {user && (
              <>
                {screen === 'dash' && <Dashboard user={user} onLogout={logout} onStartQuiz={start} />}
                {screen === 'quiz' && <QuizEngine questions={qs} onFinish={finish} onCancel={() => setScreen('dash')} />}
                {screen === 'results' && <Results questions={qs} answers={ans} onBack={() => setScreen('dash')} />}
              </>
            )}
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
